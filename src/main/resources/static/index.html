<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>CodeLeader Demo - 構造解析全画面版</title>
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* 上部：コード入力 + ボタン */
        #input-container {
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        #code-input {
            width: 80%;
            height: 80px;
            font-family: monospace;
        }
        #status {
            margin-left: 10px;
            font-weight: bold;
        }

        /* 下部：右ペイン（構造解析結果）全画面表示 */
        #right-pane {
            flex: 1;
            padding: 10px;
            overflow: auto;
            background: #f9f9f9;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .added { background-color: #d4ffd4; }
        .removed { background-color: #ffd4d4; }
        .modified { background-color: #fff5cc; }
    </style>
</head>
<body>

<!-- 上部：コード入力 -->
<div id="input-container">
    <textarea id="code-input" placeholder="Javaコードを入力"></textarea>
    <button id="analyze-btn">構造解析</button>
    <span id="status"></span>
</div>

<!-- 下部：右ペイン全画面表示 -->
<div id="right-pane">
    <h3>構造解析結果</h3>
    <pre id="result">ここに解析結果が表示されます</pre>
</div>

<script>
    const codeInput = document.getElementById('code-input');
    const analyzeBtn = document.getElementById('analyze-btn');
    const statusSpan = document.getElementById('status');
    const resultPre = document.getElementById('result');

    analyzeBtn.onclick = async () => {
        const code = codeInput.value.trim();
        if (!code) { alert("コードを入力してください"); return; }

        analyzeBtn.disabled = true;
        statusSpan.textContent = "解析中…";
        resultPre.textContent = "";

        try {
            const res = await fetch('/api/analysis/parse-structure', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ code })
            });

            if (!res.ok) throw new Error("構造解析に失敗しました");

            const data = await res.json();
            resultPre.textContent = JSON.stringify(data, null, 2);

        } catch (err) {
            console.error(err);
            resultPre.textContent = "エラー: " + err.message;
        } finally {
            analyzeBtn.disabled = false;
            statusSpan.textContent = "";
        }
    };
</script>

</body>
</html>
